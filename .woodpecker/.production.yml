# This file is used for woodpecker ci to build and deploy site.

pipeline:
  prepare:
    image: node:18
    commands:
      - npm config set registry https://repo.nju.edu.cn/repository/npm/ # 修改源
      - npm install
      - npx --cache ./npx-cache vercel --version
  production-build:
    image: node:18
    commands:
      - npx --cache ./npx-cache vercel --token=$VERCEL_TOKEN link --yes --project=my-blog
      - npx --cache ./npx-cache vercel --token=$VERCEL_TOKEN pull --yes --environment=production
      - npx --cache ./npx-cache vercel --token=$VERCEL_TOKEN build --prod --yes
    secrets: [ VERCEL_TOKEN ]
  production-deploy:
    image: node:18
    commands:
      - npx --cache ./npx-cache vercel --token=$VERCEL_TOKEN deploy --prebuilt --yes --prod
    secrets: [ VERCEL_TOKEN ]